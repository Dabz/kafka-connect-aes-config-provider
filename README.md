# Kafka Connect AES Config Provider

This is an implementation of Kafka Connect config provider that leverage symmetric-key block cipher to encrypt and decrypt secret in connector configuration.
Two JARs are generated by the project:

- `kafka-connect-aes-config-provider-<version>-command.jar` , a small CLI utility to generate key, encrypt and decrypt payloads
- `kafka-connect-aes-config-provider-<version>.jar` , JAR to include in Kafka Connect classpath to inject the Config Provider.

## Quickstart

1. Add `kafka-connect-aes-config-provider-<version>.jar` to your Apache Kafka Connect classpath.
1. Generate one or multiple keys by leveraging the CLI: `java -jar kafka-connect-aes-config-provider-<version>-command.jar generatekey`
1. Configure the AES config provider:
```
config.providers=aes
config.providers.aes.class=io.dabz.AESCBCConfigProvider
config.providers.aes.param.keys.<keyname>.key=<base64 key>
config.providers.aes.param.keys.<keyname>.iv=<16 chars IV>
```
1. Encrypt the relevant secret by leveraging the CLI: `java -jar kafka-connect-aes-config-provider-<version>-command.jar encrypt <base64 key> <IV> <payload to encrypt>`
1. Leverage your secrets in your connectors by specifying: `${aes:<key_name>:<encrypted_value>}`

## CLI

```bash
# Generate key
java -jar kafka-connect-aes-config-provider-<version>-command.jar generatekey

# Encrypt data
java -jar kafka-connect-aes-config-provider-<version>-command.jar encrypt <base64 key> <iv> <payload>

# Decrypt data
java -jar kafka-connect-aes-config-provider-<version>-command.jar decrypt <base64 key> <iv> <encrypted payload>
```

## Config Provider Configuration

- `keys.<key name>.key`: base64 AES CBC key
- `keys.<key name>.iv`: 16 chars initialization vector

## Connector configuration

`${<provider name>:<key name>:<encrypted value>}`

# Example

Kafka Connect configuration

```
# AES Config Provider

config.providers=aes
config.providers.aes.class=io.dabz.AESCBCConfigProvider
config.providers.aes.param.keys.test.key=rXEM9J7EqGwUt40r+7ejphu7Q0L+ERuwp48CXiujIAY=
config.providers.aes.param.keys.test.iv=1234567891234567
```

Connector configuration
```json
{
  "name": "file-source",
  "connector.class": "FileStreamSource",
  "tasks.max": "1",
  "file": "${aes:test:vyKiran2DliRxhXXlCpT0g==}",
  "topic": "file-test",
  "key.converter": "org.apache.kafka.connect.storage.StringConverter",
  "value.converter": "org.apache.kafka.connect.storage.StringConverter",
  "producer.override.sasl.jaas.config": "org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required  username=\"mds\" password=\"${aes:test:jQnOBoPYjnGRIiEwtmiaPg==}\" metadataServerUrls=\"http://localhost:8090\";"
}

````
